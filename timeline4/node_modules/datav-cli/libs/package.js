var root    = process.cwd();
var path    = require('path');
var fs      = require('fs-extra');
var pack    = require('./utils/pack');
var request = require('./utils/request');
var npm     = require('npm');

module.exports = function(){
  // auth.check(function(err){
  //   if (err) return console.error(err);
    console.log('install npm dependencies');
    npmInstall(function(err){
      if(err) {
        return console.error(err);
      }
      try {
        var config = require(path.join(root, 'package.json'));
      } catch(e) {
        return console.error('parse package.json failed')
      }
      pack(config.name, config.version, path.join(root, '../'), function(err){
        if(err) {
          return console.error(err);
        } else {
          console.log('package success!')
        }
      });
    });
  // });
}

function npmInstall (callback) {
  return callback();
  try {
    var config = require(path.join(root, 'package.json'));
  } catch(e) {
    callback('parse package.json failed')
  }
  npm.load(config, function(err) {
    if(err) { return callback('package.json failed') }
    npm.commands.install([], function(err){
      if(err) { return callback('npm install failed') }
      callback();
    })
  });
}
