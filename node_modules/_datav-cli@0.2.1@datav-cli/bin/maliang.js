#!/usr/bin/env node

"use strict"

var cmd = require('commander');
var packages = require('../libs/package');
var preview = require('../libs/preview');
var checkVersion = require('../libs/version');
var config = require('../package.json');
var comInit = require('../libs/init');
var _checkVersion = require('../libs/utils/checkVersion');


function list(val) {
  return val.split(',');
}

cmd
  .usage('[options] <folder|file...>')
  .version(config.version)
  .description('马良开发工具')

  .option('-v, --verbose', 'increase verbosity')
  .option('-E, --exclude <items>', 'exclude file or folder', list)

cmd
  .command('package')
  .alias('pag')
  .description('打包组件')
  .action(packages)

cmd
  .command('start')
  .alias('run')
  .option('-p --port [value]', 'custom server port')
  .option('-s --silent', 'keep silent')
  .option('-l --local', 'use local remote')
  .description('预览组件')
  .action(preview)

cmd.command('help')
  .description('help')
  .action(function () {
    cmd.help();
  });

cmd.command('latest')
  .description('check maliang latest version')
  .action(checkVersion);

cmd.command('init')
  .description('init com for datav-coms')
  .action(function () {
    _checkVersion(function () {
      comInit();
    })
  })

cmd.version('v' + config.version);

cmd.parse(process.argv);

if (!cmd.args.length) {
  cmd.help();
}
